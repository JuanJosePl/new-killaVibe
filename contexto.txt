ya te mandare los archivos del front viejos para que lo tomes de referencia.

analiza los 2 contexto e integra los requerimientos que pide el backend. a las paginas o compponentes ya hechos

1- contexto global

# ğŸ§  CONTEXTO TÃ‰CNICO GLOBAL - MÃ“DULO AUTH

## ğŸ“Œ INFORMACIÃ“N GENERAL

**Proyecto**: KillaVibes E-commerce  
**MÃ³dulo**: AutenticaciÃ³n (AUTH)  
**Backend**: Node.js + Express + MongoDB + JWT  
**Frontend**: React.js + Vite + TailwindCSS + Axios + Formik + Yup  
**Estado**: âœ… Completamente integrado y sincronizado

---

## ğŸ”— ARQUITECTURA COMPLETA

### Backend (Node.js/Express/MongoDB)

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ modules/
â”‚   â”‚   â””â”€â”€ auth/
â”‚   â”‚       â”œâ”€â”€ auth.controller.js     â†’ Controladores HTTP (req/res)
â”‚   â”‚       â”œâ”€â”€ auth.service.js        â†’ LÃ³gica de negocio
â”‚   â”‚       â”œâ”€â”€ auth.routes.js         â†’ DefiniciÃ³n de rutas
â”‚   â”‚       â”œâ”€â”€ auth.model.js          â†’ Modelo de usuario (Mongoose)
â”‚   â”‚       â””â”€â”€ auth.validation.js     â†’ Validaciones Joi
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ auth.js                    â†’ authMiddleware (verifica JWT)
â”‚   â”‚   â””â”€â”€ admin.js                   â†’ adminMiddleware (verifica rol)
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â””â”€â”€ generateToken.js       â†’ GeneraciÃ³n/verificaciÃ³n JWT
â”‚   â”‚   â”œâ”€â”€ errors/
â”‚   â”‚   â”‚   â”œâ”€â”€ ApiError.js            â†’ Clase de errores personalizados
â”‚   â”‚   â”‚   â””â”€â”€ errorHandler.js        â†’ Middleware global de errores
â”‚   â”‚   â””â”€â”€ constants/
â”‚   â”‚       â””â”€â”€ roles.js               â†’ Roles del sistema
```

### Frontend (React.js/Vite)

```
frontend/
â””â”€â”€ src/
    â”œâ”€â”€ core/
    â”‚   â”œâ”€â”€ api/
    â”‚   â”‚   â””â”€â”€ axiosInstance.js       â†’ Cliente HTTP con interceptores
    â”‚   â”œâ”€â”€ config/
    â”‚   â”‚   â””â”€â”€ env.js                 â†’ Variables de entorno
    â”‚   â”œâ”€â”€ guards/
    â”‚   â”‚   â”œâ”€â”€ PrivateRoute.jsx       â†’ ProtecciÃ³n rutas privadas
    â”‚   â”‚   â””â”€â”€ AdminRoute.jsx         â†’ ProtecciÃ³n rutas admin
    â”‚   â”œâ”€â”€ hooks/
    â”‚   â”‚   â””â”€â”€ useAuth.js             â†’ Hook principal de auth
    â”‚   â””â”€â”€ providers/
    â”‚       â””â”€â”€ AuthProvider.jsx       â†’ Contexto global de auth
    â”‚
    â””â”€â”€ modules/
        â””â”€â”€ auth/
            â”œâ”€â”€ api/
            â”‚   â””â”€â”€ auth.api.js        â†’ Llamadas HTTP de auth
            â”œâ”€â”€ hooks/
            â”‚   â””â”€â”€ useAuthActions.js  â†’ Acciones de auth
            â”œâ”€â”€ pages/
            â”‚   â”œâ”€â”€ Login.jsx          â†’ PÃ¡gina de login
            â”‚   â””â”€â”€ Register.jsx       â†’ PÃ¡gina de registro
            â”œâ”€â”€ schemas/
            â”‚   â””â”€â”€ auth.schema.js     â†’ Validaciones Yup
            â””â”€â”€ types/
                â””â”€â”€ auth.types.js      â†’ Tipos y constantes
```

---

## ğŸ” ESTRUCTURA DE DATOS

### User Model (MongoDB)

```javascript
{
  _id: ObjectId,
  email: String (unique, lowercase, required),
  password: String (hashed, min 6 chars),
  profile: {
    firstName: String (max 50, required),
    lastName: String (max 50, required),
    phone: String (7-20 chars, optional),
    avatar: String (optional)
  },
  role: String (enum: ['customer', 'moderator', 'admin']),
  isActive: Boolean (default: true),
  emailVerified: Boolean (default: false),
  loginAttempts: Number (default: 0),
  lockUntil: Date (null si no bloqueado),
  lastLogin: Date,
  lastLoginIp: String,
  loginHistory: Array,
  createdAt: Date,
  updatedAt: Date
}
```

### JWT Tokens

**Access Token (24h)**:
```json
{
  "id": "507f1f77bcf86cd799439011",
  "role": "customer",
  "iat": 1234567890,
  "exp": 1234653890
}
```

**Refresh Token (7d)**:
```json
{
  "id": "507f1f77bcf86cd799439011",
  "iat": 1234567890,
  "exp": 1235172690
}
```

---

## ğŸ“¡ ENDPOINTS DEL BACKEND

### 1. Registro de Usuario

**Endpoint**: `POST /api/auth/register`  
**Acceso**: PÃºblico  
**Body**:
```json
{
  "email": "user@example.com",
  "password": "SecurePass123",
  "firstName": "John",
  "lastName": "Doe",
  "phone": "+57 300 123 4567"  // Opcional
}
```

**Validaciones (Joi)**:
- email: email vÃ¡lido, max 100, required
- password: min 6, required
- firstName: max 50, solo letras, required
- lastName: max 50, solo letras, required
- phone: 7-20 chars, nÃºmeros/sÃ­mbolos, optional

**Respuesta Exitosa (201)**:
```json
{
  "success": true,
  "message": "Usuario registrado exitosamente",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "_id": "507f1f77bcf86cd799439011",
      "email": "user@example.com",
      "profile": {
        "firstName": "John",
        "lastName": "Doe",
        "phone": "+57 300 123 4567"
      },
      "role": "customer",
      "isActive": true,
      "emailVerified": false,
      "fullName": "John Doe",
      "createdAt": "2024-01-01T00:00:00.000Z",
      "updatedAt": "2024-01-01T00:00:00.000Z"
    }
  }
}
```

**Errores**:
- **409**: Ya existe un usuario con este email
- **400**: Errores de validaciÃ³n

---

### 2. Login

**Endpoint**: `POST /api/auth/login`  
**Acceso**: PÃºblico  
**Body**:
```json
{
  "email": "user@example.com",
  "password": "SecurePass123"
}
```

**Respuesta Exitosa (200)**:
```json
{
  "success": true,
  "message": "Login exitoso",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": { /* igual que registro */ }
  }
}
```

**Errores**:
- **401**: Email o contraseÃ±a incorrectos
- **423**: Cuenta bloqueada (5+ intentos fallidos)
- **403**: Cuenta desactivada

---

### 3. Obtener Perfil

**Endpoint**: `GET /api/auth/profile`  
**Acceso**: Privado (requiere token)  
**Headers**:
```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**Respuesta Exitosa (200)**:
```json
{
  "success": true,
  "data": {
    "user": { /* datos del usuario */ }
  }
}
```

**Errores**:
- **401**: Token invÃ¡lido o expirado
- **404**: Usuario no encontrado

---

### 4. Actualizar Perfil

**Endpoint**: `PUT /api/auth/profile`  
**Acceso**: Privado (requiere token)  
**Headers**: `Authorization: Bearer <token>`  
**Body**:
```json
{
  "firstName": "Jane",
  "lastName": "Doe",
  "phone": "+57 301 234 5678"
}
```

**ValidaciÃ³n**: Al menos 1 campo requerido

**Respuesta Exitosa (200)**:
```json
{
  "success": true,
  "message": "Perfil actualizado exitosamente",
  "data": {
    "user": { /* usuario actualizado */ }
  }
}
```

---

### 5. Refresh Token

**Endpoint**: `POST /api/auth/refresh-token`  
**Acceso**: PÃºblico (requiere refresh token)  
**Body**:
```json
{
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**Respuesta Exitosa (200)**:
```json
{
  "success": true,
  "message": "Token refrescado exitosamente",
  "data": {
    "token": "nuevo_access_token"
  }
}
```

**Errores**:
- **401**: Refresh token invÃ¡lido o expirado

---

### 6. Logout

**Endpoint**: `POST /api/auth/logout`  
**Acceso**: Privado (requiere token)  
**Headers**: `Authorization: Bearer <token>`

**Respuesta Exitosa (200)**:
```json
{
  "success": true,
  "message": "Logout exitoso"
}
```

---

## ğŸ”„ FLUJO DE AUTENTICACIÃ“N

### 1. Registro

```
Usuario â†’ Frontend (validaciÃ³n Yup) â†’ Backend (validaciÃ³n Joi)
                                    â†“
                              Crear usuario en DB
                                    â†“
                         Generar access + refresh tokens
                                    â†“
                    Guardar tokens en localStorage
                                    â†“
                           Redirigir segÃºn rol
```

### 2. Login

```
Usuario â†’ Frontend (validaciÃ³n Yup) â†’ Backend (validaciÃ³n Joi)
                                    â†“
                           Verificar credenciales
                                    â†“
                        Verificar cuenta no bloqueada
                                    â†“
                         Generar access + refresh tokens
                                    â†“
                    Guardar tokens en localStorage
                                    â†“
                           Redirigir segÃºn rol
```

### 3. Request Protegido

```
Frontend â†’ axiosInstance (interceptor agrega token)
                â†“
        Backend authMiddleware
                â†“
      Verificar token vÃ¡lido
                â†“
         Buscar usuario en DB
                â†“
      Adjuntar user a req.user
                â†“
        Ejecutar controlador
```

### 4. Refresh AutomÃ¡tico

```
Request â†’ Backend responde 401
            â†“
  axiosInstance intercepta 401
            â†“
  Extrae refreshToken de localStorage
            â†“
  POST /auth/refresh-token
            â†“
  Recibe nuevo access token
            â†“
  Guarda nuevo token
            â†“
  Reintenta request original
```

---

## ğŸ›¡ï¸ SEGURIDAD

### ProtecciÃ³n Contra Fuerza Bruta

- **Max 5 intentos fallidos** â†’ Cuenta bloqueada 15 minutos
- **Bloqueo automÃ¡tico** en `auth.model.js` (`incrementLoginAttempts`)
- **Reset automÃ¡tico** tras login exitoso

### Validaciones Sincronizadas

| ValidaciÃ³n | Backend (Joi) | Frontend (Yup) |
|------------|---------------|----------------|
| Email      | âœ…             | âœ…              |
| Password   | âœ…             | âœ…              |
| FirstName  | âœ…             | âœ…              |
| LastName   | âœ…             | âœ…              |
| Phone      | âœ…             | âœ…              |

### Headers de Seguridad

```javascript
// En login response
res.setHeader('Cache-Control', 'no-store, no-cache, must-revalidate, max-age=0');
res.setHeader('Pragma', 'no-cache');
```

---

## ğŸ‘¥ ROLES Y PERMISOS

### Roles Disponibles

```javascript
ROLES = {
  CUSTOMER: 'customer',      // Cliente normal
  MODERATOR: 'moderator',    // Moderador
  ADMIN: 'admin'             // Administrador
}
```

### Permisos por Rol

| AcciÃ³n                | customer | moderator | admin |
|-----------------------|----------|-----------|-------|
| Ver productos         | âœ…        | âœ…         | âœ…     |
| Crear carrito         | âœ…        | âœ…         | âœ…     |
| Crear reseÃ±as         | âœ…        | âœ…         | âœ…     |
| Moderar productos     | âŒ        | âœ…         | âœ…     |
| Gestionar usuarios    | âŒ        | âŒ         | âœ…     |
| Acceder a /admin      | âŒ        | âœ…         | âœ…     |

### Middlewares de ProtecciÃ³n

```javascript
// Solo autenticados
router.get('/profile', authMiddleware, controller);

// Solo admins
router.delete('/users/:id', authMiddleware, adminMiddleware, controller);

// Admins o moderators
router.put('/products/:id', authMiddleware, moderatorMiddleware, controller);
```

---

## ğŸ¨ FRONTEND - HOOKS Y COMPONENTES

### useAuth() - Hook Principal

```javascript
const {
  user,              // Usuario actual (null si no autenticado)
  token,             // Access token
  refreshToken,      // Refresh token
  loading,           // Cargando inicial
  isAuthenticated,   // Boolean: Â¿autenticado?
  login,             // FunciÃ³n login
  register,          // FunciÃ³n register
  logout,            // FunciÃ³n logout
  updateProfile,     // FunciÃ³n updateProfile
  refreshUserProfile // Recarga perfil
} = useAuth();
```

### useAuthActions() - Acciones con Loading/Error

```javascript
const { 
  handleLogin,
  handleRegister,
  handleLogout,
  handleUpdateProfile,
  loading,
  error,
  clearError
} = useAuthActions({
  onSuccess: (result) => toast.success('Ã‰xito'),
  onError: (errorMsg) => toast.error(errorMsg),
  redirectTo: '/'
});
```

### PrivateRoute - ProtecciÃ³n de Rutas

```javascript
<PrivateRoute>
  <ProfilePage />
</PrivateRoute>
```

### AdminRoute - ProtecciÃ³n por Rol

```javascript
<AdminRoute allowedRoles={['admin', 'moderator']}>
  <AdminDashboard />
</AdminRoute>
```

---

## ğŸ“¦ DEPENDENCIAS FRONTEND

```json
{
  "axios": "^1.6.2",           // Cliente HTTP
  "formik": "^2.4.5",          // Manejo de formularios
  "yup": "^1.3.3",             // ValidaciÃ³n de schemas
  "react-router-dom": "^6.20.0" // Enrutamiento
}
```

---

## ğŸ› ERRORES COMUNES Y SOLUCIONES

### 1. "Usuario no autenticado correctamente"

**Causa**: Token invÃ¡lido en `req.user`  
**SoluciÃ³n**: Verificar que authMiddleware funciona correctamente

### 2. "Ya existe un usuario con este email"

**Causa**: Email duplicado  
**SoluciÃ³n**: Usar otro email o hacer login

### 3. "Cuenta bloqueada temporalmente..."

**Causa**: 5+ intentos fallidos  
**SoluciÃ³n**: Esperar 15 min o resetear manualmente en DB

### 4. Token expira constantemente

**Causa**: Refresh token no funciona  
**SoluciÃ³n**: Verificar interceptor de axiosInstance

---

## ğŸš€ CÃ“MO USAR ESTA INFORMACIÃ“N CON OTRAS IAs

### Prompt para Otras IAs:

```
Estoy trabajando en un proyecto e-commerce con autenticaciÃ³n JWT.

**Contexto tÃ©cnico**:
- Backend: Node.js + Express + MongoDB + JWT
- Frontend: React.js + Vite + Axios + Formik
- MÃ³dulo AUTH completamente integrado

**Backend**:
- Endpoints: /register, /login, /profile, /refresh-token, /logout
- Validaciones: Joi en backend, Yup en frontend (sincronizadas)
- Tokens: Access (24h) + Refresh (7d)
- Roles: customer, moderator, admin
- ProtecciÃ³n fuerza bruta: 5 intentos â†’ bloqueo 15min

**Frontend**:
- axiosInstance con interceptores (refresh automÃ¡tico)
- AuthProvider con contexto global
- useAuth() hook principal
- PrivateRoute y AdminRoute para proteger rutas

**Estructura de respuestas**:
```json
{
  "success": true/false,
  "message": "...",
  "data": { "token", "refreshToken", "user" },
  "errors": [{ "field", "message" }]
}
```

**Mi pregunta**: [TU PREGUNTA AQUÃ]
```

---

## âœ… CHECKLIST DE INTEGRACIÃ“N

- [x] Backend: Controladores, servicios, rutas, validaciones
- [x] Backend: Middlewares (auth, admin)
- [x] Backend: GeneraciÃ³n/verificaciÃ³n de tokens
- [x] Backend: ProtecciÃ³n fuerza bruta
- [x] Frontend: axiosInstance con interceptores
- [x] Frontend: AuthProvider (contexto global)
- [x] Frontend: useAuth hook
- [x] Frontend: useAuthActions hook
- [x] Frontend: PÃ¡ginas Login/Register con validaciÃ³n
- [x] Frontend: ProtecciÃ³n de rutas (PrivateRoute, AdminRoute)
- [x] Frontend: Schemas Yup sincronizados con Joi
- [x] Frontend: Manejo de errores del backend
- [x] Frontend: Refresh automÃ¡tico de tokens
- [x] DocumentaciÃ³n completa

---

**Estado**: âœ… COMPLETAMENTE INTEGRADO  
**SincronizaciÃ³n Backend-Frontend**: 100%  
**Validaciones**: Exactas  
**Seguridad**: Implementada  
**Roles**: Funcionales  
**Tokens**: AutomÃ¡ticos  

**PrÃ³ximos mÃ³dulos**: Products, Cart, Orders, Payments, etc.

2 contexto global

2- contexto global

# ğŸ§  CONTEXTO TÃ‰CNICO GLOBAL - MÃ“DULO PRODUCTS

## ğŸ“Œ INFORMACIÃ“N GENERAL

**Proyecto**: KillaVibes E-commerce  
**MÃ³dulo**: Productos (PRODUCTS) y CategorÃ­as (CATEGORIES)  
**Backend**: Node.js + Express + MongoDB + Joi  
**Frontend**: React.js + Vite + TailwindCSS + Axios + React Router  
**Estado**: âœ… Completamente integrado y sincronizado

---

## ğŸ”— ARQUITECTURA COMPLETA

### Backend (Node.js/Express/MongoDB)

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ modules/
â”‚   â”‚   â”œâ”€â”€ products/
â”‚   â”‚   â”‚   â”œâ”€â”€ product.controller.js     â†’ Controladores HTTP
â”‚   â”‚   â”‚   â”œâ”€â”€ product.service.js        â†’ LÃ³gica de negocio
â”‚   â”‚   â”‚   â”œâ”€â”€ product.routes.js         â†’ Rutas API
â”‚   â”‚   â”‚   â”œâ”€â”€ product.model.js          â†’ Modelo Mongoose
â”‚   â”‚   â”‚   â”œâ”€â”€ product.validation.js     â†’ Validaciones Joi
â”‚   â”‚   â”‚   â””â”€â”€ product.utils.js          â†’ Utilidades
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ categories/
â”‚   â”‚   â”‚   â”œâ”€â”€ category.controller.js
â”‚   â”‚   â”‚   â”œâ”€â”€ category.service.js
â”‚   â”‚   â”‚   â”œâ”€â”€ category.routes.js
â”‚   â”‚   â”‚   â”œâ”€â”€ category.model.js
â”‚   â”‚   â”‚   â””â”€â”€ category.validation.js
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ search/
â”‚   â”‚       â”œâ”€â”€ search.controller.js
â”‚   â”‚       â”œâ”€â”€ search.service.js
â”‚   â”‚       â”œâ”€â”€ search.routes.js
â”‚   â”‚       â”œâ”€â”€ search.model.js
â”‚   â”‚       â””â”€â”€ search.validation.js
â”‚   â”‚
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ auth.js                    â†’ authMiddleware, requireRole
â”‚   â”‚   â””â”€â”€ error.js                   â†’ Manejo global de errores
â”‚   â”‚
â”‚   â””â”€â”€ core/
â”‚       â”œâ”€â”€ errors/
â”‚       â”‚   â””â”€â”€ ApiError.js            â†’ Errores personalizados
â”‚       â””â”€â”€ utils/
â”‚           â”œâ”€â”€ catchAsync.js          â†’ Wrapper async/await
â”‚           â””â”€â”€ paginator.js           â†’ PaginaciÃ³n
```

### Frontend (React.js/Vite)

```
frontend/
â””â”€â”€ src/
    â”œâ”€â”€ core/
    â”‚   â”œâ”€â”€ api/
    â”‚   â”‚   â””â”€â”€ axiosInstance.js       â†’ Cliente HTTP con interceptores
    â”‚   â”‚
    â”‚   â”œâ”€â”€ guards/
    â”‚   â”‚   â”œâ”€â”€ PrivateRoute.jsx       â†’ ProtecciÃ³n rutas privadas
    â”‚   â”‚   â””â”€â”€ AdminRoute.jsx         â†’ ProtecciÃ³n rutas admin
    â”‚   â”‚
    â”‚   â””â”€â”€ hooks/
    â”‚       â”œâ”€â”€ useAuth.js             â†’ Hook de autenticaciÃ³n
    â”‚       â””â”€â”€ useApi.js              â†’ Hook para llamadas API
    â”‚
    â””â”€â”€ modules/
        â””â”€â”€ products/
            â”œâ”€â”€ api/
            â”‚   â”œâ”€â”€ products.api.js        â†’ Llamadas HTTP productos
            â”‚   â””â”€â”€ categories.api.js      â†’ Llamadas HTTP categorÃ­as
            â”‚
            â”œâ”€â”€ hooks/
            â”‚   â”œâ”€â”€ useProducts.js         â†’ Hook lista productos
            â”‚   â”œâ”€â”€ useProductDetails.js   â†’ Hook detalle producto
            â”‚   â”œâ”€â”€ useCategories.js       â†’ Hook categorÃ­as
            â”‚   â”œâ”€â”€ useProductFilters.js   â†’ Hook filtros
            â”‚   â””â”€â”€ useProductSearch.js    â†’ Hook bÃºsqueda
            â”‚
            â”œâ”€â”€ pages/
            â”‚   â”œâ”€â”€ ProductList.jsx        â†’ PÃ¡gina lista productos
            â”‚   â”œâ”€â”€ ProductDetail.jsx      â†’ PÃ¡gina detalle producto
            â”‚   â”œâ”€â”€ CategoryProducts.jsx   â†’ Productos por categorÃ­a
            â”‚   â””â”€â”€ SearchResults.jsx      â†’ Resultados bÃºsqueda
            â”‚
            â”œâ”€â”€ components/
            â”‚   â”œâ”€â”€ ProductCard.jsx        â†’ Tarjeta de producto
            â”‚   â”œâ”€â”€ ProductGrid.jsx        â†’ Grid de productos
            â”‚   â”œâ”€â”€ ProductFilters.jsx     â†’ Filtros de productos
            â”‚   â”œâ”€â”€ ProductSort.jsx        â†’ Ordenamiento
            â”‚   â””â”€â”€ CategoryCard.jsx       â†’ Tarjeta de categorÃ­a
            â”‚
            â”œâ”€â”€ utils/
            â”‚   â”œâ”€â”€ productHelpers.js      â†’ Utilidades productos
            â”‚   â””â”€â”€ priceHelpers.js        â†’ Formateo precios
            â”‚
            â””â”€â”€ types/
                â””â”€â”€ product.types.js       â†’ Constantes y enums
```

---

## ğŸ” ESTRUCTURA DE DATOS

### Product Model (MongoDB)

```javascript
{
  _id: ObjectId,
  name: String (3-120 chars, required),
  slug: String (unique, lowercase, indexed),
  description: String (10-5000 chars, required),
  shortDescription: String (max 300),
  
  // PRECIOS
  price: Number (required, min 0),
  comparePrice: Number (optional, >= price),
  costPrice: Number (optional, <= price),
  
  // INVENTARIO
  sku: String (unique, uppercase),
  stock: Number (default 0, min 0),
  trackQuantity: Boolean (default true),
  allowBackorder: Boolean (default false),
  lowStockThreshold: Number (default 5),
  
  // CATEGORIZACIÃ“N
  categories: [ObjectId] (ref: 'Category'),
  mainCategory: ObjectId (ref: 'Category'),
  tags: [String] (lowercase),
  brand: String (max 100),
  
  // IMÃGENES
  images: [{
    url: String (required),
    altText: String,
    title: String,
    isPrimary: Boolean,
    order: Number
  }],
  
  // ATRIBUTOS
  attributes: {
    size: [String],
    color: [String],
    material: [String],
    weight: String,
    dimensions: {
      length: Number,
      width: Number,
      height: Number,
      unit: String (default 'cm')
    }
  },
  
  // VARIANTES
  variants: [{
    sku: String (unique),
    name: String,
    price: Number,
    comparePrice: Number,
    stock: Number,
    attributes: Object,
    images: [String],
    isActive: Boolean
  }],
  
  // SEO
  seo: {
    title: String (max 60),
    description: String (max 160),
    metaKeywords: [String],
    canonicalUrl: String
  },
  
  // MÃ‰TRICAS
  views: Number (default 0),
  salesCount: Number (default 0),
  rating: {
    average: Number (0-5),
    count: Number,
    distribution: {
      _1: Number,
      _2: Number,
      _3: Number,
      _4: Number,
      _5: Number
    }
  },
  
  // ESTADO
  status: String (enum: ['active', 'draft', 'archived', 'discontinued']),
  visibility: String (enum: ['public', 'private', 'hidden']),
  isFeatured: Boolean (default false),
  isPublished: Boolean (default false),
  publishedAt: Date,
  
  // AUDITORÃA
  createdBy: ObjectId (ref: 'User'),
  updatedBy: ObjectId (ref: 'User'),
  createdAt: Date,
  updatedAt: Date
}
```

### Category Model (MongoDB)

```javascript
{
  _id: ObjectId,
  name: String (2-100 chars, unique, required),
  slug: String (unique, lowercase),
  description: String (max 1000),
  parentCategory: ObjectId (ref: 'Category'),
  
  images: {
    thumbnail: String,
    hero: String,
    icon: String
  },
  
  seo: {
    metaTitle: String (max 60),
    metaDescription: String (max 160),
    keywords: [String],
    ogImage: String,
    ogDescription: String
  },
  
  isActive: Boolean (default true),
  isPublished: Boolean (default true),
  featured: Boolean (default false),
  order: Number (default 0),
  
  views: Number (default 0),
  productCount: Number (default 0),
  
  createdBy: ObjectId (ref: 'User'),
  updatedBy: ObjectId (ref: 'User'),
  status: String (enum: ['active', 'archived', 'draft']),
  
  createdAt: Date,
  updatedAt: Date
}
```

---

## ğŸ“¡ ENDPOINTS DEL BACKEND

### 1. Productos

#### GET /api/products
**Acceso**: PÃºblico  
**Query Params**:
```javascript
{
  page: Number (default 1),
  limit: Number (default 12, max 100),
  sort: String (default 'createdAt'),
  order: String ('asc' | 'desc', default 'desc'),
  category: String,
  search: String (min 2 chars),
  minPrice: Number,
  maxPrice: Number,
  status: String (default 'active'),
  visibility: String (default 'public'),
  featured: Boolean,
  inStock: Boolean,
  brand: String
}
```

**Respuesta (200)**:
```json
{
  "success": true,
  "message": "Productos obtenidos exitosamente",
  "data": [{ /* productos */ }],
  "pagination": {
    "current": 1,
    "limit": 12,
    "pages": 5,
    "total": 60,
    "hasNextPage": true,
    "hasPrevPage": false
  }
}
```

---

#### GET /api/products/:slug
**Acceso**: PÃºblico  
**Respuesta (200)**:
```json
{
  "success": true,
  "data": { /* producto completo */ }
}
```

---

#### GET /api/products/featured
**Acceso**: PÃºblico  
**Query**: `?limit=8`  
**Respuesta (200)**:
```json
{
  "success": true,
  "count": 8,
  "data": [{ /* productos destacados */ }]
}
```

---

#### GET /api/products/related/:productId
**Acceso**: PÃºblico  
**Query**: `?limit=4`  
**Respuesta (200)**:
```json
{
  "success": true,
  "count": 4,
  "data": [{ /* productos relacionados */ }]
}
```

---

#### GET /api/products/search/:query
**Acceso**: PÃºblico  
**Query**: `?limit=10`  
**Respuesta (200)**:
```json
{
  "success": true,
  "count": 10,
  "data": [{ /* productos encontrados */ }]
}
```

---

#### GET /api/products/category/:categorySlug
**Acceso**: PÃºblico  
**Query Params**: Igual que GET /products  
**Respuesta (200)**:
```json
{
  "success": true,
  "data": [{ /* productos */ }],
  "pagination": { /* paginaciÃ³n */ }
}
```

---

#### POST /api/products/check-stock/:productId
**Acceso**: PÃºblico  
**Body**:
```json
{
  "quantity": 2
}
```

**Respuesta (200)**:
```json
{
  "success": true,
  "data": {
    "available": true,
    "stock": 15,
    "allowBackorder": false
  }
}
```

---

#### GET /api/products/top-selling
**Acceso**: PÃºblico  
**Query**: `?limit=10`  
**Respuesta (200)**:
```json
{
  "success": true,
  "count": 10,
  "data": [{ /* productos mÃ¡s vendidos */ }]
}
```

---

#### POST /api/products (ADMIN)
**Acceso**: Admin/Moderator (requiere token)  
**Headers**: `Authorization: Bearer <token>`  
**Body**: Datos del producto  
**Respuesta (201)**:
```json
{
  "success": true,
  "message": "Producto creado exitosamente",
  "data": { /* producto creado */ }
}
```

---

#### PUT /api/products/:id (ADMIN)
**Acceso**: Admin/Moderator  
**Headers**: `Authorization: Bearer <token>`  
**Body**: Campos a actualizar  
**Respuesta (200)**:
```json
{
  "success": true,
  "message": "Producto actualizado exitosamente",
  "data": { /* producto actualizado */ }
}
```

---

#### DELETE /api/products/:id (ADMIN)
**Acceso**: Admin  
**Headers**: `Authorization: Bearer <token>`  
**Respuesta (200)**:
```json
{
  "success": true,
  "message": "Producto archivado exitosamente"
}
```

---

### 2. CategorÃ­as

#### GET /api/categories
**Acceso**: PÃºblico  
**Query**:
```javascript
{
  featured: Boolean,
  parentOnly: Boolean,
  withProductCount: Boolean,
  sortBy: String (default 'order'),
  page: Number,
  limit: Number (default 50)
}
```

---

#### GET /api/categories/tree
**Acceso**: PÃºblico  
**Respuesta**: Ãrbol jerÃ¡rquico de categorÃ­as

---

#### GET /api/categories/featured
**Acceso**: PÃºblico  
**Query**: `?limit=6`

---

#### GET /api/categories/popular
**Acceso**: PÃºblico  
**Query**: `?limit=10`

---

#### GET /api/categories/search
**Acceso**: PÃºblico  
**Query**: `?q=searchterm`

---

#### GET /api/categories/:slug
**Acceso**: PÃºblico  
**Respuesta (200)**:
```json
{
  "success": true,
  "data": {
    /* categorÃ­a con subcategorÃ­as, breadcrumb, productCount */
  }
}
```

---

## ğŸ”„ FLUJO DE INTEGRACIÃ“N FRONTEND

### 1. Lista de Productos

```
Usuario â†’ ProductList.jsx
           â†“
        useProducts(filters)
           â†“
        products.api.getProducts()
           â†“
        axiosInstance.get('/products?...')
           â†“
        Backend: product.controller.getProducts()
           â†“
        product.service.getProducts()
           â†“
        Mongoose query con filtros
           â†“
        Respuesta: { success, data, pagination }
           â†“
        Frontend actualiza estado
           â†“
        Renderiza ProductCard[]
```

---

### 2. Detalle de Producto

```
Usuario â†’ ProductDetail.jsx
           â†“
        useProductDetails(slug)
           â†“
        products.api.getProductBySlug(slug)
           â†“
        axiosInstance.get('/products/:slug')
           â†“
        Backend: product.controller.getProductBySlug()
           â†“
        product.service.getProductBySlug()
           â†“
        Producto incrementa vistas
           â†“
        Respuesta: { success, data }
           â†“
        Frontend muestra producto
           â†“
        useRelatedProducts() carga relacionados
```

---

### 3. BÃºsqueda con Debounce

```
Usuario escribe â†’ useProductSearch()
                      â†“
                  Debounce 300ms
                      â†“
                  Valida min 2 chars
                      â†“
                  searchProducts(query)
                      â†“
                  axiosInstance.get('/products/search/:query')
                      â†“
                  Backend busca con full-text
                      â†“
                  Respuesta: { success, data }
                      â†“
                  Frontend muestra resultados
```

---

## ğŸ›¡ï¸ SEGURIDAD Y VALIDACIONES

### Validaciones Sincronizadas (Backend Joi)

| Campo           | Backend Joi                              |
|-----------------|------------------------------------------|
| name            | 3-120 chars, required                    |
| description     | 10-5000 chars, required                  |
| shortDescription| max 300 chars, optional                  |
| price           | positive number, required                |
| comparePrice    | positive, >= price, optional             |
| stock           | integer, min 0, required                 |
| sku             | uppercase, unique                        |
| slug            | lowercase, unique                        |

### Middlewares de ProtecciÃ³n

```javascript
// Rutas pÃºblicas
router.get('/products', validate(getProductsValidation), controller);

// Rutas protegidas (requieren auth)
router.post('/products', 
  authMiddleware, 
  requireRole('admin', 'moderator'), 
  validate(createProductValidation), 
  controller
);

// Solo admin
router.delete('/products/:id', 
  authMiddleware, 
  requireRole('admin'), 
  validate(idValidation), 
  controller
);
```

---

## ğŸ“¦ UTILIDADES Y HELPERS

### productHelpers.js
- `calculateDiscount(comparePrice, price)` â†’ Porcentaje descuento
- `isProductAvailable(product)` â†’ Verifica disponibilidad
- `isLowStock(product)` â†’ Stock bajo
- `getPrimaryImage(product)` â†’ Imagen principal
- `getAvailabilityStatus(product)` â†’ Estado disponibilidad
- `isNewProduct(product)` â†’ Producto nuevo (<7 dÃ­as)
- `getAverageRating(product)` â†’ Rating promedio

### priceHelpers.js
- `formatPrice(price)` â†’ "$115,000"
- `calculateTotal(price, quantity)` â†’ Precio total
- `calculateDiscountPercentage(original, discounted)` â†’ % descuento
- `formatPriceRange(min, max)` â†’ "$ X - $ Y"

---

## ğŸ¨ CONSTANTES Y ENUMS

### product.types.js

```javascript
// Estados
PRODUCT_STATUS = {
  ACTIVE: 'active',
  DRAFT: 'draft',
  ARCHIVED: 'archived',
  DISCONTINUED: 'discontinued'
}

// Visibilidad
PRODUCT_VISIBILITY = {
  PUBLIC: 'public',
  PRIVATE: 'private',
  HIDDEN: 'hidden'
}

// Disponibilidad
AVAILABILITY_STATUS = {
  AVAILABLE: 'available',
  LOW_STOCK: 'low_stock',
  BACKORDER: 'backorder',
  OUT_OF_STOCK: 'out_of_stock'
}

// Ordenamiento
PRODUCT_SORT_OPTIONS = {
  NEWEST: 'createdAt',
  PRICE_LOW: 'price',
  NAME: 'name',
  SALES: 'salesCount',
  RATING: 'rating.average'
}
```

---

## ğŸ› ERRORES COMUNES Y SOLUCIONES

### 1. "Producto no encontrado"
**Causa**: Slug incorrecto o producto archivado  
**SoluciÃ³n**: Verificar slug y estado del producto

### 2. "Stock insuficiente"
**Causa**: Cantidad solicitada > stock disponible  
**SoluciÃ³n**: Verificar `checkStock()` antes de agregar al carrito

### 3. "Errores de validaciÃ³n"
**Causa**: Datos no cumplen con Joi validation  
**SoluciÃ³n**: Validar en frontend con mismas reglas

### 4. Token expirado
**Causa**: Access token expirÃ³  
**SoluciÃ³n**: axiosInstance interceptor refresca automÃ¡ticamente

---

## ğŸš€ CÃ“MO USAR CON OTRAS IAs

### Prompt para Otras IAs:

```
Estoy trabajando en un e-commerce con productos y categorÃ­as.

**Contexto tÃ©cnico**:
- Backend: Node.js + Express + MongoDB + Joi
- Frontend: React.js + Vite + Axios
- MÃ³dulo PRODUCTS completamente integrado

**Backend Endpoints**:
- GET /products â†’ Lista paginada con filtros
- GET /products/:slug â†’ Detalle por slug
- GET /products/featured â†’ Destacados
- GET /products/search/:query â†’ BÃºsqueda full-text
- POST /products/check-stock/:productId â†’ Verificar stock
- GET /categories â†’ Lista de categorÃ­as
- GET /categories/:slug â†’ Detalle categorÃ­a

**Frontend Hooks**:
- `useProducts(filters)` â†’ Lista con filtros
- `useProductDetails(slug)` â†’ Detalle producto
- `useCategories()` â†’ Lista categorÃ­as
- `useProductSearch()` â†’ BÃºsqueda con debounce
- `useProductFilters()` â†’ Manejo filtros

**Estructura de respuestas**:
```json
{
  "success": true/false,
  "message": "...",
  "data": { /* datos */ },
  "pagination": { /* si aplica */ },
  "errors": [{ "field", "message" }]
}
```

**Mi pregunta**: [TU PREGUNTA AQUÃ]
```

---

## âœ… CHECKLIST DE INTEGRACIÃ“N

- [x] Backend: Controllers, Services, Routes, Models
- [x] Backend: Validaciones Joi completas
- [x] Backend: Middlewares (auth, admin)
- [x] Backend: Ãndices MongoDB optimizados
- [x] Frontend: API calls (products, categories)
- [x] Frontend: Hooks (useProducts, useProductDetails, etc.)
- [x] Frontend: Utilidades (productHelpers, priceHelpers)
- [x] Frontend: Tipos y constantes
- [x] Frontend: Manejo de errores
- [x] Frontend: Filtros y bÃºsqueda
- [x] DocumentaciÃ³n completa

---

**Estado**: âœ… COMPLETAMENTE INTEGRADO  
**SincronizaciÃ³n Backend-Frontend**: 100%  
**Validaciones**: Exactas  
**Filtros**: Funcionales  
**BÃºsqueda**: Con debounce  
**PaginaciÃ³n**: Operativa  

**PrÃ³ximos mÃ³dulos**: Cart, Orders, Reviews, Wishlist

âœ… RESUMEN FINAL
He completado la integraciÃ³n del mÃ³dulo PRODUCTS con los siguientes archivos creados en tu nuevo frontend:
ğŸ“‚ Archivos Creados

API Calls:

products.api.js â†’ Todas las llamadas HTTP de productos
categories.api.js â†’ Todas las llamadas HTTP de categorÃ­as


Hooks:

useProducts.js â†’ Lista de productos con filtros
useProductDetails.js â†’ Detalle de producto y relacionados
useCategories.js â†’ CategorÃ­as y Ã¡rbol jerÃ¡rquico
useProductFilters.js â†’ Manejo de filtros con URL sync
useProductSearch.js â†’ BÃºsqueda con debounce


Utilidades:

productHelpers.js â†’ 20+ funciones de utilidad
priceHelpers.js â†’ Formateo y cÃ¡lculos de precios


Tipos y Constantes:

product.types.js â†’ Enums, constantes, configuraciones


## ğŸ¯ LISTO PARA INTEGRACIÃ“N

Ahora necesito los **archivos del frontend viejo** para:

1. Ver cÃ³mo manejas actualmente los productos
2. Detectar patrones de UI/UX que quieres mantener
3. Identificar componentes reutilizables
4. Entender el flujo de filtros/bÃºsqueda

---

## ğŸ‘‰ ENVÃAME LOS ARCHIVOS DEL FRONTEND VIEJO

Estoy listo para recibir:
```
ğŸ“‚ Frontend VIEJO - Para Referencia
â”œâ”€â”€ src/services/productService.js
â”œâ”€â”€ src/services/categoryService.js
â”œâ”€â”€ src/hooks/useProducts.js
â”œâ”€â”€ lib/products.js
â”œâ”€â”€ app/productos/page.jsx
â”œâ”€â”€ app/productos/[id]/page.jsx
â”œâ”€â”€ app/categorias/page.jsx
â”œâ”€â”€ app/categorias/[id]/page.jsx
â”œâ”€â”€ components/product-card.jsx
â”œâ”€â”€ components/product-filters.jsx
â”œâ”€â”€ components/product-sort.jsx
â”œâ”€â”€ components/featured-products.jsx
â””â”€â”€ components/categories-section.jsx



ğŸ“‚ Frontend NUEVO - MÃ³dulo PRODUCTS (a integrar)
â”œâ”€â”€ src/modules/products/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ products.api.js          âœ¨ Llamadas HTTP de productos
â”‚   â”‚   â””â”€â”€ categories.api.js        âœ¨ Llamadas HTTP de categorÃ­as
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useProducts.js           âœ¨ Hook principal de productos
â”‚   â”‚   â”œâ”€â”€ useProductDetails.js     âœ¨ Hook de detalle de producto
â”‚   â”‚   â”œâ”€â”€ useCategories.js         âœ¨ Hook de categorÃ­as
â”‚   â”‚   â”œâ”€â”€ useProductFilters.js     âœ¨ Hook de filtros
â”‚   â”‚   â””â”€â”€ useProductSearch.js      âœ¨ Hook de bÃºsqueda
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ ProductList.jsx          âœ¨ PÃ¡gina de lista de productos
â”‚   â”‚   â”œâ”€â”€ ProductDetail.jsx        âœ¨ PÃ¡gina de detalle de producto
â”‚   â”‚   â”œâ”€â”€ CategoryProducts.jsx     âœ¨ PÃ¡gina de productos por categorÃ­a
â”‚   â”‚   â””â”€â”€ SearchResults.jsx        âœ¨ PÃ¡gina de resultados de bÃºsqueda
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ProductCard.jsx          âœ¨ Tarjeta de producto
â”‚   â”‚   â”œâ”€â”€ ProductGrid.jsx          âœ¨ Grid de productos
â”‚   â”‚   â”œâ”€â”€ ProductFilters.jsx       âœ¨ Filtros de productos
â”‚   â”‚   â”œâ”€â”€ ProductSort.jsx          âœ¨ Ordenamiento de productos
â”‚   â”‚   â”œâ”€â”€ CategoryCard.jsx         âœ¨ Tarjeta de categorÃ­a
â”‚   â”‚   â”œâ”€â”€ CategoryList.jsx         âœ¨ Lista de categorÃ­as
â”‚   â”‚   â”œâ”€â”€ FeaturedProducts.jsx     âœ¨ Productos destacados
â”‚   â”‚   â”œâ”€â”€ ProductImage.jsx         âœ¨ Imagen de producto con zoom
â”‚   â”‚   â”œâ”€â”€ ProductSpecs.jsx         âœ¨ Especificaciones
â”‚   â”‚   â””â”€â”€ ProductReviews.jsx       âœ¨ ReseÃ±as de producto
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â””â”€â”€ product.schema.js        âœ¨ Validaciones Yup (si hay forms)
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ product.types.js         âœ¨ Tipos, constantes, enums
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ productHelpers.js        âœ¨ Utilidades de productos
â”‚       â””â”€â”€ priceHelpers.js          âœ¨ Formateo de precios
â”‚
â””â”€â”€ src/modules/store/
    â””â”€â”€ products.store.js            âœ¨ Zustand store (opcional, si usas)


este codigo quiero que lo completes siguiendo el contexto yy requerimientos del backend

import { useState, useEffect } from 'react';
import { Link, useSearchParams } from 'react-router-dom';
import { 
  ShoppingCart, Heart, Eye, Star, Zap, Truck, Shield, 
  Filter, Grid, List, X, ChevronDown 
} from 'lucide-react';

// Importaciones de hooks personalizados
import { useProducts } from '../../hooks/useProducts';
import { useProductFilters } from '../../hooks/useProductFilters';
import { useAuth } from '../../contexts/AuthContext';

// Importaciones de componentes UI
import { Button } from '../../components/ui/button';
import { Badge } from '../../components/ui/badge';
import { Card, CardContent } from '../../components/ui/card';
import { Checkbox } from '../../components/ui/checkbox';
import { Label } from '../../components/ui/label';

// Importaciones de utilidades
import { formatPrice, calculateDiscountPercentage, isProductAvailable } from '../../utils/priceHelpers';
import { isNewProduct, isLowStock, getPrimaryImage } from '../../utils/productHelpers';

export default function ProductsListPage() {
  const [searchParams, setSearchParams] = useSearchParams();
  const { isAuthenticated } = useAuth();
  
  // Estados locales
  const [viewMode, setViewMode] = useState('grid');
  const [showFilters, setShowFilters] = useState(false);

  // Hook de filtros con sincronizaciÃ³n URL
  const { filters, updateFilter, clearFilters, hasActiveFilters } = useProductFilters();

  // Hook de productos con datos del backend
  const { products, loading, error, pagination, refetch } = useProducts(filters);

  // Sincronizar filtros con URL params
  useEffect(() => {
    const category = searchParams.get('category');
    const search = searchParams.get('search');
    const minPrice = searchParams.get('minPrice');
    const maxPrice = searchParams.get('maxPrice');
    
    if (category) updateFilter('category', category);
    if (search) updateFilter('search', search);
    if (minPrice) updateFilter('minPrice', Number(minPrice));
    if (maxPrice) updateFilter('maxPrice', Number(maxPrice));
  }, [searchParams]);

  // Actualizar URL cuando cambian los filtros
  useEffect(() => {
    const params = new URLSearchParams();
    if (filters.category) params.set('category', filters.category);
    if (filters.search) params.set('search', filters.search);
    if (filters.minPrice) params.set('minPrice', filters.minPrice);
    if (filters.maxPrice) params.set('maxPrice', filters.maxPrice);
    setSearchParams(params);
  }, [filters]);

  const handleSortChange = (value) => {
    updateFilter('sort', value);
  };

  const handlePageChange = (newPage) => {
    updateFilter('page', newPage);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };

  // LOADING STATE
  if (loading) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-background to-muted/30">
        <div className="container mx-auto px-4 py-8">
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
            {[...Array(8)].map((_, i) => (
              <div key={i} className="animate-pulse">
                <div className="bg-gradient-to-br from-muted to-muted/50 rounded-2xl h-64 mb-4"></div>
                <div className="h-4 bg-muted rounded w-3/4 mb-2"></div>
                <div className="h-4 bg-muted rounded w-1/2 mb-4"></div>
                <div className="h-12 bg-muted rounded-xl"></div>
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  }

  // ERROR STATE
  if (error) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-background to-muted/30 flex items-center justify-center">
        <div className="text-center">
          <div className="text-6xl mb-4">ğŸ˜•</div>
          <h2 className="text-2xl font-bold text-foreground mb-4">
            Error al cargar productos
          </h2>
          <p className="text-muted-foreground mb-6">{error}</p>
          <Button onClick={() => refetch()} className="btn-primary">
            Reintentar
          </Button>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-background to-muted/30">
      <div className="container mx-auto px-4 py-8">
        {/* HEADER */}
        <div className="text-center mb-12">
          <div className="inline-flex items-center justify-center w-20 h-20 bg-primary/10 rounded-full mb-6">
            <span className="text-3xl">ğŸ›ï¸</span>
          </div>
          <h1 className="text-4xl lg:text-5xl font-bold mb-4 bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent">
            {filters.search ? `"${filters.search}"` : 'Nuestros Productos'}
          </h1>
          <p className="text-xl text-muted-foreground max-w-2xl mx-auto">
            {filters.search
              ? `Encontramos ${pagination.total || 0} producto${pagination.total !== 1 ? 's' : ''} para ti`
              : 'Descubre nuestra colecciÃ³n exclusiva de productos tecnolÃ³gicos'}
          </p>
        </div>

        {/* FILTERS BAR */}
        <div className="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-8 p-6 bg-card/50 backdrop-blur-sm rounded-2xl border border-border/50">
          <div className="flex items-center gap-4">
            <Button
              variant="outline"
              onClick={() => setShowFilters(!showFilters)}
              className="flex items-center gap-2"
            >
              <Filter className="h-4 w-4" />
              Filtros
              {hasActiveFilters && (
                <span className="ml-2 h-2 w-2 rounded-full bg-primary animate-pulse" />
              )}
            </Button>

            {hasActiveFilters && (
              <Button
                variant="ghost"
                size="sm"
                onClick={clearFilters}
                className="flex items-center gap-2"
              >
                <X className="h-4 w-4" />
                Limpiar filtros
              </Button>
            )}

            <div className="flex items-center gap-2 bg-background rounded-lg p-1">
              <Button
                variant={viewMode === 'grid' ? 'default' : 'ghost'}
                size="sm"
                onClick={() => setViewMode('grid')}
              >
                <Grid className="h-4 w-4" />
              </Button>
              <Button
                variant={viewMode === 'list' ? 'default' : 'ghost'}
                size="sm"
                onClick={() => setViewMode('list')}
              >
                <List className="h-4 w-4" />
              </Button>
            </div>
          </div>

          <div className="flex items-center gap-4">
            <select
              value={filters.sort}
              onChange={(e) => handleSortChange(e.target.value)}
              className="bg-background border border-border rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary"
            >
              <option value="createdAt">MÃ¡s recientes</option>
              <option value="price">Precio: Menor a Mayor</option>
              <option value="-price">Precio: Mayor a Menor</option>
              <option value="name">Nombre A-Z</option>
              <option value="-salesCount">MÃ¡s vendidos</option>
              <option value="-rating.average">Mejor valorados</option>
            </select>
          </div>
        </div>

        {/* FILTERS PANEL (Collapsible) */}
        {showFilters && (
          <Card className="mb-8 animate-slide-in-up">
            <CardContent className="p-6">
              <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                {/* Price Range */}
                <div>
                  <h3 className="font-semibold mb-3">Rango de Precio</h3>
                  <div className="space-y-2">
                    <input
                      type="number"
                      placeholder="Precio mÃ­nimo"
                      value={filters.minPrice || ''}
                      onChange={(e) => updateFilter('minPrice', e.target.value)}
                      className="w-full px-3 py-2 border border-border rounded-lg"
                    />
                    <input
                      type="number"
                      placeholder="Precio mÃ¡ximo"
                      value={filters.maxPrice || ''}
                      onChange={(e) => updateFilter('maxPrice', e.target.value)}
                      className="w-full px-3 py-2 border border-border rounded-lg"
                    />
                  </div>
                </div>

                {/* Stock Status */}
                <div>
                  <h3 className="font-semibold mb-3">Disponibilidad</h3>
                  <div className="flex items-center space-x-2">
                    <Checkbox
                      id="inStock"
                      checked={filters.inStock || false}
                      onCheckedChange={(checked) => updateFilter('inStock', checked)}
                    />
                    <Label htmlFor="inStock" className="cursor-pointer">
                      Solo productos en stock
                    </Label>
                  </div>
                </div>

                {/* Featured */}
                <div>
                  <h3 className="font-semibold mb-3">Destacados</h3>
                  <div className="flex items-center space-x-2">
                    <Checkbox
                      id="featured"
                      checked={filters.featured || false}
                      onCheckedChange={(checked) => updateFilter('featured', checked)}
                    />
                    <Label htmlFor="featured" className="cursor-pointer">
                      Solo productos destacados
                    </Label>
                  </div>
                </div>
              </div>
            </CardContent>
          </Card>
        )}

        {/* PRODUCTS GRID/LIST */}
        {products.length === 0 ? (
          <div className="text-center py-16">
            <div className="text-8xl mb-6">ğŸ”</div>
            <h3 className="text-2xl font-semibold text-foreground mb-4">
              No se encontraron productos
            </h3>
            <p className="text-muted-foreground mb-6 max-w-md mx-auto">
              {filters.search
                ? 'No encontramos productos que coincidan con tu bÃºsqueda. Intenta con otros tÃ©rminos.'
                : 'Pronto agregaremos mÃ¡s productos a nuestra colecciÃ³n.'}
            </p>
            <div className="flex flex-col sm:flex-row gap-4 justify-center">
              <Button onClick={clearFilters} className="btn-primary">
                Ver Todos los Productos
              </Button>
              <Link to="/categorias">
                <Button variant="outline">Explorar CategorÃ­as</Button>
              </Link>
            </div>
          </div>
        ) : (
          <>
            {/* Products Display */}
            <div className={viewMode === 'grid' 
              ? 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8'
              : 'space-y-6'
            }>
              {products.map((product, index) => (
                <ProductCardEnhanced
                  key={product._id}
                  product={product}
                  viewMode={viewMode}
                  index={index}
                  isAuthenticated={isAuthenticated}
                />
              ))}
            </div>

            {/* PAGINATION */}
            {pagination && pagination.pages > 1 && (
              <div className="flex flex-col sm:flex-row justify-between items-center gap-4 mt-12 p-6 bg-card/50 backdrop-blur-sm rounded-2xl border border-border/50">
                <div className="text-sm text-muted-foreground">
                  Mostrando {((pagination.current - 1) * pagination.limit) + 1} - {Math.min(pagination.current * pagination.limit, pagination.total)} de {pagination.total} productos
                </div>

                <div className="flex items-center space-x-2">
                  <Button
                    onClick={() => handlePageChange(pagination.current - 1)}
                    disabled={!pagination.hasPrevPage}
                    variant="outline"
                  >
                    Anterior
                  </Button>

                  <div className="flex items-center space-x-2">
                    {[...Array(Math.min(5, pagination.pages))].map((_, i) => {
                      const pageNum = i + 1;
                      return (
                        <Button
                          key={pageNum}
                          variant={pagination.current === pageNum ? 'default' : 'outline'}
                          onClick={() => handlePageChange(pageNum)}
                          className="w-10 h-10"
                        >
                          {pageNum}
                        </Button>
                      );
                    })}
                  </div>

                  <Button
                    onClick={() => handlePageChange(pagination.current + 1)}
                    disabled={!pagination.hasNextPage}
                    variant="outline"
                  >
                    Siguiente
                  </Button>
                </div>
              </div>
            )}
          </>
        )}
      </div>
    </div>
  );
}

// ==================== PRODUCT CARD COMPONENT ====================
function ProductCardEnhanced({ product, viewMode, index, isAuthenticated }) {
  const [isHovered, setIsHovered] = useState(false);
  const [isImageLoaded, setIsImageLoaded] = useState(false);

  const discountPercentage = calculateDiscountPercentage(product.comparePrice, product.price);
  const isNew = isNewProduct(product);
  const lowStock = isLowStock(product);
  const available = isProductAvailable(product);
  const primaryImage = getPrimaryImage(product);

  return (
    <div
      className={`group bg-gradient-to-br from-card to-card/80 backdrop-blur-sm rounded-2xl border-2 border-border/50 hover:border-primary/30 transition-all duration-500 hover:shadow-2xl hover:scale-105 overflow-hidden ${viewMode === 'list' ? 'flex' : ''} animate-slide-in-up`}
      style={{ animationDelay: `${index * 0.1}s` }}
      onMouseEnter={() => setIsHovered(true)}
      onMouseLeave={() => setIsHovered(false)}
    >
      {/* Product Image */}
      <div className={`relative overflow-hidden ${viewMode === 'list' ? 'w-48 flex-shrink-0' : 'aspect-square'}`}>
        <Link to={`/productos/${product.slug}`}>
          {!isImageLoaded && (
            <div className="absolute inset-0 bg-gradient-to-br from-muted via-muted/50 to-muted animate-shimmer" />
          )}
          <img
            src={primaryImage}
            alt={product.name}
            className={`w-full h-full object-cover transition-all duration-700 ${isImageLoaded ? 'opacity-100' : 'opacity-0'} ${isHovered ? 'scale-110' : 'scale-100'}`}
            onLoad={() => setIsImageLoaded(true)}
          />
        </Link>

        {/* Badges */}
        <div className="absolute top-3 left-3 flex flex-col space-y-2">
          {discountPercentage > 0 && (
            <Badge className="bg-gradient-to-r from-red-500 to-orange-500 text-white">
              <Zap className="h-3 w-3 mr-1" />
              -{discountPercentage}%
            </Badge>
          )}
          {product.isFeatured && (
            <Badge className="bg-gradient-to-r from-primary to-purple-600 text-white">
              <Star className="h-3 w-3 mr-1" />
              Destacado
            </Badge>
          )}
          {isNew && (
            <Badge className="bg-gradient-to-r from-green-500 to-emerald-600 text-white">
              NUEVO
            </Badge>
          )}
          {lowStock && (
            <Badge className="bg-gradient-to-r from-orange-500 to-red-500 text-white">
              Â¡Ãšltimos {product.stock}!
            </Badge>
          )}
        </div>

        {/* Quick View Overlay */}
        <div className={`absolute inset-0 bg-black/60 flex items-center justify-center transition-opacity duration-300 ${isHovered ? 'opacity-100' : 'opacity-0 pointer-events-none'}`}>
          <Link to={`/productos/${product.slug}`}>
            <Button className="bg-white text-foreground hover:bg-white/90">
              <Eye className="h-4 w-4 mr-2" />
              Ver Detalles
            </Button>
          </Link>
        </div>
      </div>

      {/* Product Info */}
      <div className={`p-6 ${viewMode === 'list' ? 'flex-1' : ''}`}>
        <div className="space-y-3">
          {/* Category */}
          {product.mainCategory && (
            <div className="text-xs text-muted-foreground uppercase tracking-wide font-semibold">
              {product.mainCategory.name}
            </div>
          )}

          {/* Title */}
          <Link to={`/productos/${product.slug}`}>
            <h3 className="font-bold text-lg leading-tight line-clamp-2 group-hover:text-primary transition-colors">
              {product.name}
            </h3>
          </Link>

          {/* Description */}
          <p className="text-sm text-muted-foreground line-clamp-2">
            {product.shortDescription || product.description}
          </p>

          {/* Rating */}
          {product.rating?.average && (
            <div className="flex items-center space-x-2">
              <div className="flex items-center space-x-1">
                {[1, 2, 3, 4, 5].map((star) => (
                  <Star
                    key={star}
                    className={`h-3 w-3 ${star <= Math.round(product.rating.average) ? 'fill-yellow-400 text-yellow-400' : 'text-gray-300'}`}
                  />
                ))}
              </div>
              <span className="text-xs text-muted-foreground">
                ({product.rating.average.toFixed(1)})
              </span>
            </div>
          )}

          {/* Price */}
          <div className="space-y-2">
            <div className="flex items-baseline space-x-2">
              <span className="text-2xl font-bold text-primary">
                {formatPrice(product.price)}
              </span>
              {product.comparePrice && product.comparePrice > product.price && (
                <span className="text-sm line-through text-muted-foreground">
                  {formatPrice(product.comparePrice)}
                </span>
              )}
            </div>
            {discountPercentage > 0 && (
              <div className="text-xs text-green-600 font-semibold">
                Ahorras {formatPrice(product.comparePrice - product.price)}
              </div>
            )}
          </div>

          {/* Features */}
          <div className="flex items-center justify-between pt-3 border-t border-border/50">
            <div className="flex items-center space-x-4 text-xs text-muted-foreground">
              <div className="flex items-center space-x-1">
                <Truck className="h-4 w-4" />
                <span>EnvÃ­o gratis</span>
              </div>
              <div className="flex items-center space-x-1">
                <Shield className="h-4 w-4" />
                <span>GarantÃ­a</span>
              </div>
            </div>
          </div>

          {/* Add to Cart Button */}
          <Link to={`/productos/${product.slug}`}>
            <Button
              disabled={!available}
              className={`w-full py-3 font-semibold transition-all duration-300 mt-4 ${!available ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'btn-primary hover:scale-105'}`}
            >
              <ShoppingCart className="h-4 w-4 mr-2" />
              {!isAuthenticated ? 'Ver detalles' : !available ? 'Agotado' : 'Ver producto'}
            </Button>
          </Link>
        </div>
      </div>
    </div>
  );
}

este componente quedo icompleto : 

import { useState, useEffect } from 'react';
import { 
  ShoppingCart, Heart, Eye, Star, Zap, Truck, Shield, 
  Filter, Grid, List, X, ChevronDown, Sparkles
} from 'lucide-react';

// ==================== MOCK DATA & HELPERS ====================
const formatPrice = (price) => {
  return new Intl.NumberFormat('es-CO', {
    style: 'currency',
    currency: 'COP',
    minimumFractionDigits: 0,
  }).format(price);
};

const calculateDiscountPercentage = (comparePrice, price) => {
  if (!comparePrice || comparePrice <= price) return 0;
  return Math.round((1 - price / comparePrice) * 100);
};

const isNewProduct = (product) => {
  if (!product.createdAt) return false;
  const daysSinceCreation = (Date.now() - new Date(product.createdAt).getTime()) / (1000 * 60 * 60 * 24);
  return daysSinceCreation <= 7;
};

const isLowStock = (product) => {
  return product.stock > 0 && product.stock <= 5;
};

const isProductAvailable = (product) => {
  return product.status === 'active' && product.isPublished && (product.stock > 0 || product.allowBackorder);
};

const getPrimaryImage = (product) => {
  const primaryImg = product.images?.find(img => img.isPrimary);
  return primaryImg?.url || product.images?.[0]?.url || '/placeholder-product.jpg';
};

// Mock API call
const mockFetchProducts = async (filters) => {
  await new Promise(resolve => setTimeout(resolve, 800));
  
  return {
    success: true,
    data: [
      {
        _id: '1',
        name: 'AirPods Pro 2da GeneraciÃ³n',
        slug: 'airpods-pro-2da-generacion',
        price: 899000,
        comparePrice: 999000,
        description: 'AudÃ­fonos inalÃ¡mbricos con cancelaciÃ³n activa de ruido',
        shortDescription: 'Sonido premium con cancelaciÃ³n de ruido',
        images: [{ url: 'https://images.unsplash.com/photo-1600294037681-c80b4cb5b434?w=500', isPrimary: true }],
        stock: 15,
        mainCategory: { name: 'Audio' },
        isFeatured: true,
        status: 'active',
        isPublished: true,
        rating: { average: 4.8, count: 124 },
        createdAt: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
      },
      {
        _id: '2',
        name: 'Parlante JBL Flip 6',
        slug: 'parlante-jbl-flip-6',
        price: 499000,
        comparePrice: 599000,
        description: 'Parlante Bluetooth portÃ¡til con sonido surround',
        shortDescription: 'Sonido potente y portÃ¡til',
        images: [{ url: 'https://images.unsplash.com/photo-1608043152269-423dbba4e7e1?w=500', isPrimary: true }],
        stock: 3,
        mainCategory: { name: 'Audio' },
        isFeatured: true,
        status: 'active',
        isPublished: true,
        rating: { average: 4.6, count: 89 },
        createdAt: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString(),
      },
      {
        _id: '3',
        name: 'Smartwatch Galaxy Watch 5',
        slug: 'smartwatch-galaxy-watch-5',
        price: 799000,
        comparePrice: 849000,
        description: 'Reloj inteligente con monitoreo de salud avanzado',
        shortDescription: 'Fitness y salud en tu muÃ±eca',
        images: [{ url: 'https://images.unsplash.com/photo-1551816230-ef5deaed4a26?w=500', isPrimary: true }],
        stock: 12,
        mainCategory: { name: 'Wearables' },
        isFeatured: false,
        status: 'active',
        isPublished: true,
        rating: { average: 4.7, count: 67 },
        createdAt: new Date(Date.now() - 15 * 24 * 60 * 60 * 1000).toISOString(),
      },
      {
        _id: '4',
        name: 'Tablet iPad Air',
        slug: 'tablet-ipad-air',
        price: 1299000,
        comparePrice: 1399000,
        description: 'Tablet potente para trabajo y creatividad',
        shortDescription: 'Productividad sin lÃ­mites',
        images: [{ url: 'https://images.unsplash.com/photo-1544244015-0df4b3ffc6b0?w=500', isPrimary: true }],
        stock: 6,
        mainCategory: { name: 'Tablets' },
        isFeatured: true,
        status: 'active',
        isPublished: true,
        rating: { average: 4.9, count: 203 },
        createdAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
      },
      {
        _id: '5',
        name: 'Teclado MecÃ¡nico RGB',
        slug: 'teclado-mecanico-rgb',
        price: 299000,
        description: 'Teclado mecÃ¡nico para gaming con retroiluminaciÃ³n RGB',
        shortDescription: 'Gaming de alta precisiÃ³n',
        images: [{ url: 'https://images.unsplash.com/photo-1595225476474-87563907a212?w=500', isPrimary: true }],
        stock: 8,
        mainCategory: { name: 'Gaming' },
        isFeatured: false,
        status: 'active',
        isPublished: true,
        rating: { average: 4.5, count: 45 },
        createdAt: new Date(Date.now() - 20 * 24 * 60 * 60 * 1000).toISOString(),
      },
      {
        _id: '6',
        name: 'CÃ¡mara Web HD 1080p',
        slug: 'camara-web-hd-1080p',
        price: 189000,
        description: 'CÃ¡mara web profesional para videollamadas y streaming',
        shortDescription: 'Videollamadas cristalinas',
        images: [{ url: 'https://images.unsplash.com/photo-1544890225-2f3faec4cd60?w=500', isPrimary: true }],
        stock: 20,
        mainCategory: { name: 'Accesorios' },
        isFeatured: false,
        status: 'active',
        isPublished: true,
        rating: { average: 4.3, count: 78 },
        createdAt: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
      },
      {
        _id: '7',
        name: 'Mouse Gaming InalÃ¡mbrico',
        slug: 'mouse-gaming-inalambrico',
        price: 159000,
        comparePrice: 199000,
        description: 'Mouse inalÃ¡mbrico de alta precisiÃ³n para gaming',
        shortDescription: 'PrecisiÃ³n sin cables',
        images: [{ url: 'https://images.unsplash.com/photo-1527864550417-7fd91fc51a46?w=500', isPrimary: true }],
        stock: 2,
        mainCategory: { name: 'Gaming' },
        isFeatured: true,
        status: 'active',
        isPublished: true,
        rating: { average: 4.6, count: 92 },
        createdAt: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(),
      },
      {
        _id: '8',
        name: 'Auriculares Gaming Pro',
        slug: 'auriculares-gaming-pro',
        price: 349000,
        comparePrice: 429000,
        description: 'Auriculares gaming con sonido envolvente 7.1',
        shortDescription: 'InmersiÃ³n total en el juego',
        images: [{ url: 'https://images.unsplash.com/photo-1599669454699-248893623440?w=500', isPrimary: true }],
        stock: 10,
        mainCategory: { name: 'Gaming' },
        isFeatured: true,
        status: 'active',
        isPublished: true,
        rating: { average: 4.7, count: 156 },
        createdAt: new Date(Date.now() - 4 * 24 * 60 * 60 * 1000).toISOString(),
      },
    ],
    pagination: {
      current: 1,
      limit: 12,
      pages: 1,
      total: 8,
      hasNextPage: false,
      hasPrevPage: false,
    }
  };
};

// ==================== MAIN COMPONENT ====================
export default function ProductsListPage() {
  const [products, setProducts] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [viewMode, setViewMode] = useState('grid');
  const [showFilters, setShowFilters] = useState(false);
  const [isAuthenticated] = useState(true); // Mock

  const [filters, setFilters] = useState({
    search: '',
    category: '',
    minPrice: '',
    maxPrice: '',
    sort: 'createdAt',
    page: 1,
    limit: 12,
    inStock: false,
    featured: false,
  });

  const [pagination, setPagination] = useState({});

  useEffect(() => {
    const fetchProducts = async () => {
      try {
        setLoading(true);
        const response = await mockFetchProducts(filters);
        if (response.success) {
          setProducts(response.data);
          setPagination(response.pagination);
        }
      } catch (err) {
        setError('Error al cargar productos');
      } finally {
        setLoading(false);
      }
    };

    fetchProducts();
  }, [filters]);

  const updateFilter = (key, value) => {
    setFilters(prev => ({ ...prev, [key]: value, page: 1 }));
  };

  const clearFilters = () => {
    setFilters({
      search: '',
      category: '',
      minPrice: '',
      maxPrice: '',
      sort: 'createdAt',
      page: 1,
      limit: 12,
      inStock: false,
      featured: false,
    });
  };

  const hasActiveFilters = filters.minPrice || filters.maxPrice || filters.inStock || filters.featured || filters.category;

  // LOADING STATE
  if (loading) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-50 to-blue-50">
        <div className="container mx-auto px-4 py-8">
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
            {[...Array(8)].map((_, i) => (
              <div key={i} className="animate-pulse">
                <div className="bg-gradient-to-br from-gray-200 to-gray-300 rounded-2xl h-64 mb-4"></div>
                <div className="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
                <div className="h-4 bg-gray-200 rounded w-1/2 mb-4"></div>
                <div className="h-12 bg-gray-200 rounded-xl"></div>
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  }

  // ERROR STATE
  if (error) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 flex items-center justify-center">
        <div className="text-center">
          <div className="text-6xl mb-4">ğŸ˜•</div>
          <h2 className="text-2xl font-bold text-gray-900 mb-4">Error al cargar productos</h2>
          <p className="text-gray-600 mb-6">{error}</p>
          <button 
            onClick={() => window.location.reload()} 
            className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
          >
            Reintentar
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-blue-50">
      <div className="container mx-auto px-4 py-8">
        {/* HEADER */}
        <div className="text-center mb-12">
          <div className="inline-flex items-center justify-center w-20 h-20 bg-blue-100 rounded-full mb-6">
            <span className="text-3xl">ğŸ›ï¸</span>
          </div>
          <h1 className="text-4xl lg:text-5xl font-bold mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
            {filters.search ? `"${filters.search}"` : 'Nuestros Productos'}
          </h1>
          <p className="text-xl text-gray-600 max-w-2xl mx-auto">
            {filters.search
              ? `Encontramos ${pagination.total || 0} producto${pagination.total !== 1 ? 's' : ''} para ti`
              : 'Descubre nuestra colecciÃ³n exclusiva de productos tecnolÃ³gicos'}
          </p>
        </div>

        {/* FILTERS BAR */}
        <div className="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-8 p-6 bg-white/70 backdrop-blur-sm rounded-2xl border border-gray-200 shadow-sm">
          <div className="flex items-center gap-4 flex-wrap">
            <button
              onClick={() => setShowFilters(!showFilters)}
              className="flex items-center gap-2 px-4 py-2 border-2 border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"
            >
              <Filter className="h-4 w-4" />
              Filtros
              {hasActiveFilters && (
                <span className="ml-2 h-2 w-2 rounded-full bg-blue-600 animate-pulse" />
              )}
            </button>

            {hasActiveFilters && (
              <button
                onClick={clearFilters}
                className="flex items-center gap-2 px-4 py-2 text-gray-600 hover:text-gray-900 transition-colors"
              >
                <X className="h-4 w-4" />
                Limpiar filtros
              </button>
            )}

            <div className="flex items-center gap-2 bg-white rounded-lg p-1 border border-gray-200">
              <button
                onClick={() => setViewMode('grid')}
                className={`p-2 rounded-lg transition-colors ${viewMode === 'grid' ? 'bg-blue-600 text-white' : 'text-gray-700 hover:bg-gray-100'}`}
              >
                <Grid className="h-4 w-4" />
              </button>
              <button
                onClick={() => setViewMode('list')}
                className={`p-2 rounded-lg transition-colors ${viewMode === 'list' ? 'bg-blue-600 text-white' : 'text-gray-700 hover:bg-gray-100'}`}
              >
                <List className="h-4 w-4" />
              </button>
            </div>
          </div>

          <div className="flex items-center gap-4">
            <select
              value={filters.sort}
              onChange={(e) => updateFilter('sort', e.target.value)}
              className="bg-white border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
              <option value="createdAt">MÃ¡s recientes</option>
              <option value="price">Precio: Menor a Mayor</option>
              <option value="-price">Precio: Mayor a Menor</option>
              <option value="name">Nombre A-Z</option>
              <option value="-salesCount">MÃ¡s vendidos</option>
              <option value="-rating.average">Mejor valorados</option>
            </select>
          </div>
        </div>

        {/* FILTERS PANEL */}
        {showFilters && (
          <div className="mb-8 p-6 bg-white rounded-2xl border border-gray-200 shadow-sm animate-slide-down">
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div>
                <h3 className="font-semibold mb-3 text-gray-900">Rango de Precio</h3>
                <div className="space-y-2">
                  <input
                    type="number"
                    placeholder="Precio mÃ­nimo"
                    value={filters.minPrice}
                    onChange={(e) => updateFilter('minPrice', e.target.value)}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                  />
                  <input
                    type="number"
                    placeholder="Precio mÃ¡ximo"
                    value={filters.maxPrice}
                    onChange={(e) => updateFilter('maxPrice', e.target.value)}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                  />
                </div>
              </div>

              <div>
                <h3 className="font-semibold mb-3 text-gray-900">Disponibilidad</h3>
                <label className="flex items-center space-x-2 cursor-pointer">
                  <input
                    type="checkbox"
                    checked={filters.inStock}
                    onChange={(e) => updateFilter('inStock', e.target.checked)}
                    className="w-4 h-4 text-blue-600 rounded focus:ring-blue-500"
                  />
                  <span className="text-gray-700">Solo productos en stock</span>
                </label>
              </div>

              <div>
                <h3 className="font-semibold mb-3 text-gray-900">Destacados</h3>
                <label className="flex items-center space-x-2 cursor-pointer">
                  <input
                    type="checkbox"
                    checked={filters.featured}
                    onChange={(e) => updateFilter('featured', e.target.checked)}
                    className="w-4 h-4 text-blue-600 rounded focus:ring-blue-500"
                  />
                  <span className="text-gray-700">Solo productos destacados</span>
                </label>
              </div>
            </div>
          </div>
        )}

        {/* PRODUCTS GRID */}
        {products.length === 0 ? (
          <div className="text-center py-16">
            <div className="text-8xl mb-6">ğŸ”</div>
            <h3 className="text-2xl font-semibold text-gray-900 mb-4">No se encontraron productos</h3>
            <p className="text-gray-600 mb-6 max-w-md mx-auto">
              {filters.search
                ? 'No encontramos productos que coincidan con tu bÃºsqueda.'
                : 'Pronto agregaremos mÃ¡s productos.'}
            </p>
            <button 
              onClick={clearFilters}
              className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
            >
              Ver Todos los Productos
            </button>
          </div>
        ) : (
          <div className={viewMode === 'grid' 
            ? 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8'
            : 'space-y-6'
          }>
            {products.map((product, index) => (
              <ProductCard
                key={product._id}
                product={product}
                viewMode={viewMode}
                index={index}
                isAuthenticated={isAuthenticated}
              />
            ))}
          </div>
        )}

        {/* PAGINATION */}
        {pagination && pagination.pages > 1 && (
          <div className="flex justify-center items-center gap-4 mt-12">
            <button
              onClick={() => updateFilter('page', pagination.current - 1)}
              disabled={!pagination.hasPrevPage}
              className="px-4 py-2 border-2 border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
            >
              Anterior
            </button>
            <span className="text-gray-700 font-medium">
              PÃ¡gina {pagination.current} de {pagination.pages}
            </span>
            <button
              onClick={() => updateFilter('page', pagination.current + 1)}
              disabled={!pagination.hasNextPage}
              className="px-4 py-2 border-2 border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
            >
              Siguiente
            </button>
          </div>
        )}
      </div>
    </div>
  );
}

// ==================== PRODUCT CARD ====================
function ProductCard({ product, viewMode, index, isAuthenticated }) {
  const [isHovered, setIsHovered] = useState(false);
  const [isImageLoaded, setIsImageLoaded] = useState(false);

  const discountPercentage = calculateDiscountPercentage(product.comparePrice, product.price);
  const isNew = isNewProduct(product);
  const lowStock = isLowStock(product);
  const available = isProductAvailable(product);
  const primaryImage = getPrimaryImage(product);

  return (
    <div
      className={`group bg-white rounded-2xl border-2 border-gray-200 hover:border-blue-300 transition-all duration-500 hover:shadow-2xl hover:scale-105 overflow-hidden ${viewMode === 'list' ? 'flex' : ''}`}
      style={{ animation: `slideInUp 0.5s ease-out ${index * 0.1}s both` }}
      onMouseEnter={() => setIsHovered(true)}
      onMouseLeave={() => setIsHovered(false)}
    >
      <div className={`relative overflow-hidden ${viewMode === 'list' ? 'w-48 flex-shrink-0' : 'aspect-square'}`}>
        {!isImageLoaded && (
          <div className="absolute inset-0 bg-gradient-to-br from-gray-200 via-gray-100 to-gray-200 animate-pulse" />
        )}
        <img
          src={primaryImage}
          alt={product.name}
          className={`w-full h-full object-cover transition-all duration-700 ${isImageLoaded ? 'opacity-100' : 'opacity-0'} ${isHovered ? 'scale-110' : 'scale-100'}`}
          onLoad={() => setIsImageLoaded(true)}
        />

        <div className="absolute top-3 left-3 flex flex-col space-y-2">
          {discountPercentage > 0 && (
            <span className="flex items-center space-x-1 bg-gradient-to-r from-red-500 to-orange-500 text-white px-3 py-1.5 rounded-full font-bold text-xs shadow-lg">
              <Zap className="h-3 w-3" />
              <span>-{discountPercentage}%</span>
            </span>
          )}
          {product.isFeatured && (
            <span className="flex items-center space-x-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-3 py-1.5 rounded-full font-bold text-xs shadow-lg">
              <Star className="h-3 w-3 fill-current" />
              <span>Destacado</span>
            </span>
          )}
          {isNew && (
            <span className="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-3 py-1.5 rounded-full font-bold text-xs shadow-lg">
              NUEVO
            </span>
          )}
          {lowStock && (
            <span className="bg-gradient-to-r from-orange-500 to-red-500 text-white px-3 py-1.5 rounded-full font-bold text-xs shadow-lg animate-pulse">
              Â¡Ãšltimos {product.stock}!
            </span>
          )}
        </div>

        <div className={`absolute inset-0 bg-black/60 flex items-center justify-center transition-opacity duration-300 ${isHovered ? 'opacity-100' : 'opacity-0 pointer-events-none'}`}>
          <button className="px-6 py-3 bg-white text-gray-900 rounded-lg font-semibold hover:bg-gray-50 transition-all flex items-center space-x-2">
            <Eye className="h-4 w-4" />
            <span>Ver Detalles</span>
          </button>
        </div>
      </div>

      <div className={`p-6 ${viewMode === 'list' ? 'flex-1' : ''}`}>
        <div className="space-y-3">
          {product.mainCategory && (
            <div className="text-xs text-gray-500 uppercase tracking-wide font-semibold">
              {product.mainCategory.name}
            </div>
          )}

          <h3 className="font-bold text-lg leading-tight line-clamp-2 group-hover:text-blue-600 transition-colors">
            {product.name}
          </h3>

          <p className="text-sm text-gray-600 line-clamp-2">
            {product.shortDescription || product.description}
          </p>

          {product.rating?.average && (
            <div className="flex items-center space-x-2">
              <div className="flex items-center space-x-1">
                {[1, 2, 3, 4, 5].map((star) => (
                  <Star
                    key={star}
                    className={`h-3 w-3 ${star <= Math.round(product.rating.average) ? 'fill-yellow-400 text-yellow-400' : 'text-gray-300'}`}
                  />
                ))}
              </div>
              <span className="text-xs text-gray-500">
                ({product.rating.average.toFixed(1)})
              </span>
            </div>
          )}

          <div className="space-y-2">
            <div className="flex items-baseline space-x-2">
              <span className="text-2xl font-bold text-blue-600">
                {formatPrice(product.price)}
              </span>
              {product.comparePrice && product.comparePrice > product.price && (
                <span className="text-sm line-through text-gray-500">
                  {formatPrice(product.comparePrice)}
                </span>
              )}
            </div>
            {discountPercentage > 0 && (
              <div className="text-xs text-green-600 font-semibold flex items-center space-x-1">
                <Sparkles className="h-3 w-3" />
                <span>Ahorras {formatPrice(product.comparePrice - product.price)}</span>
              </div>
            )}
          </div>

          <div className="flex items-center justify-between pt-3 border-t border-gray-200">
            <div className="flex items-center space-x-4 text-xs text-gray-600">
              <div className="flex items-center space-x-1">
                <Truck className="h-4 w-4" />
                <span>EnvÃ­o gratis</span>
              </div>
              <div className="flex items-center space-x-1">
                <Shield className="h-4 w-4" />
                <span>GarantÃ­a</span>
              </div>
            </div>
          </div>

          <button
            disabled={!available}
            className={`w-full py-3 font-semibold rounded-lg transition-all duration-300 mt-4 flex items-center justify-center space-x-2 ${!available ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'bg-gradient-to-r from-blue-600 to-blue-700 text-white hover:shadow-xl hover:scale-105'}`}
          >
            <ShoppingCart className="h-4 w-4" />
            <span>{!isAuthenticated ? 'Ver detalles' : !available ? 'Agotado' : 'Ver producto'}</span>
          </button>
        </div>
      </div>
    </div>
  );
}

// Add keyframes animation
const style = document.createElement('style');
style.textContent = `
  @keyframes slideInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  @keyframes slideDown {
    from {
      opacity: 0;
      max-height: 0;
    }
    to {
      opacity: 1;
      max-height: 1000px;
    }
  }
  
  .animate-slide-down {
    animation: slideDown 0.3s ease-out